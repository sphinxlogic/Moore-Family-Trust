XA.connector.mapsConnector=function(n,t){var i={},r=[],o=[],u=[],f=[],s=!1,v,e,h,y,p,c,l,a;return h=function(n){switch(n.mode){case"Auto":return Microsoft.Maps.MapTypeId.auto;case"Roadmap":return Microsoft.Maps.MapTypeId.road;case"Birdseye":return Microsoft.Maps.MapTypeId.birdseye;case"Satellite":return Microsoft.Maps.MapTypeId.aerial;default:return Microsoft.Maps.MapTypeId.auto}},l=function(n,t,i){t.id=i.id;u[n]?u[n].push({pin:t,type:i.type}):u[n]=[{pin:t,type:i.type}]},v=function(){var n={zoom:10,center:new Microsoft.Maps.Location("52.416213","16.984423"),mapTypeId:Microsoft.Maps.MapTypeId.auto};return new Microsoft.Maps.Map(t.createElement("div"),n)},p=function(){for(var n in r)if(r.hasOwnProperty(n))return r[n];return null},initMap=function(){for(var t=o.length,n=0;n<t;n++)o[n].call();s=!1},c=function(n,t){var i={title:n.title,description:n.description,icon:n.icon},f=r[t],u=new Microsoft.Maps.Pushpin(f.getCenter(),i);return setTimeout(function(){var n=new Image;n.onload=function(){u.setOptions({width:n.width,height:n.height})};n.src=i.icon},0),u},y=function(n){if(n.targetType=="pushpin"){var t=n.target.data.mapId,u=r[t],i;f.hasOwnProperty(t)&&(u.entities.remove(f[t]),delete f[t]);i=new Microsoft.Maps.Infobox(n.target.getLocation(),null);u.entities.push(i);i.setOptions({visible:!0,description:n.target.data.html});f[t]=i}},a=function(n,t,i){var r=p(),u,f,e;r==null&&(r=v());e=function(){r!==null&&(r.addComponent("searchManager",new Microsoft.Maps.Search.SearchManager(r)),u=r.getComponent("searchManager"),f={where:n.text,count:n.maxResults||1,callback:function(n){typeof n.results[0]!="undefined"?t(n.results):i()},errorCallback:i},u.geocode(f))};Microsoft.Maps.loadModule("Microsoft.Maps.Search",{callback:e})},i.loadScript=function(n,i){if(o.push(i),!s){s=!0;var r=t.createElement("script");r.setAttribute("src","//www.bing.com/maps/sdk/mapcontrol?v=7.0&onScriptLoad=initMap&key="+n);r.setAttribute("type","text/javascript");t.head.appendChild(r)}},i.showMap=function(n,i,u){u instanceof Array?(mapOptions={zoom:i.zoom,center:new Microsoft.Maps.Location(u[0],u[1]),mapTypeId:h(i),credentials:i.key},e=new Microsoft.Maps.Map(t.getElementById(n),mapOptions)):(mapOptions={mapTypeId:h(i),bounds:u},e=new Microsoft.Maps.Map(t.getElementById(n),mapOptions),i.poiCount<2&&e.setView({zoom:i.zoom}));i.disableMapZoomOnScroll==="1"&&Microsoft.Maps.Events.addHandler(e,"mousewheel",function(n){return n.handled=!0,!0});i.disableMapScrolling==="1"&&Microsoft.Maps.Events.addHandler(e,"mousedown",function(n){n.handled=!0});r[n]=e},i.renderPoi=function(n,t){var u=r[n],i=c(t,n);l(n,i,t);t.mapId=n;i.data=t;u.entities.push(i);i.setLocation(new Microsoft.Maps.Location(t.latitude,t.longitude));Microsoft.Maps.Events.addHandler(i,"click",y)},i.renderDynamicPoi=function(n,t,i){var e=r[n],u=c(t,n);l(n,u,t);t.mapId=n;u.data=t;e.entities.push(u);u.setLocation(new Microsoft.Maps.Location(t.latitude,t.longitude));Microsoft.Maps.Events.addHandler(u,"click",function(r){if(r.targetType=="pushpin"&&typeof i=="function"){var s=t.id,h=t.poiTypeId,o=t.poiVariantId,u;if(o==null)return;i(s,h,o,function(t){f.hasOwnProperty(n)&&(e.entities.remove(f[n]),delete f[n]);u=new Microsoft.Maps.Infobox(r.target.getLocation(),null);e.entities.push(u);u.setOptions({visible:!0,title:t.title,description:t.Html});f[n]=u})}})},i.clearMarkers=function(n){var i,e=r[n],t;if(u.hasOwnProperty(n)){for(i=u[n],t=0;t<i.length;t++)i[t].type==="Dynamic"&&e.entities.remove(i[t].pin);u[n]=i.filter(function(n){return n.type==="Static"||n.type==="MyLocation"?!0:!1})}if(f[n])for(mapInfoboxes=f[n],t=0;t<mapInfoboxes.length;t++)e.entities.remove(mapInfoboxes[t])},i.updateMapPosition=function(n,t){var f=r[n],i=[],e=[];u.hasOwnProperty(n)&&(i=u[n]);i.forEach(function(n){e.push(new Microsoft.Maps.Location(n.pin.data.latitude,n.pin.data.longitude))},this);f.setView({bounds:Microsoft.Maps.LocationRect.fromLocations(e)});i.length===1&&f.setView({zoom:t})},i.centerMap=function(n,t,i){var u=r[n];i&&typeof u!="undefined"&&u.setView({center:new Microsoft.Maps.Location(t.coordinates[0],t.coordinates[1])})},i.getCentralPoint=function(n){var t=[];return n.forEach(function(n){n.latitude!==""&&n.longitude!==""&&t.push(new Microsoft.Maps.Location(n.latitude,n.longitude))},this),Microsoft.Maps.LocationRect.fromLocations(t)},i.locationAutocomplete=function(n,t,i){var r=n.maxResults<=0?1:n.maxResults;a(n,function(n){for(var f=n.length>=r?r:n.length,u=[],i=0;i<f;i++)u.push(_.extend(n[i],{text:n[i].name,autocompleted:!0}));t(u)},function(){i()})},i.addressLookup=function(n,t,i){var r;n.autocompleted?(r=n.location,r?t([r.latitude,r.longitude]):i()):a(n,function(n){r=n[0];r.location?t([r.location.latitude,r.location.longitude]):i()},function(){i()})},i.updateMyPoiLocation=function(n,t,i){var e,f,o=r[n];u.hasOwnProperty(n)&&(e=u[n],f=e.filter(function(n){return n.type==="MyLocation"?!0:!1}),f.length>0&&(f[0].pin.setLocation(new Microsoft.Maps.Location(t[0],t[1])),f[0].pin.data.latitude=t[0],f[0].pin.data.longitude=t[1],this.updateMapPosition(n,i)))},i}(jQuery,document)